{% extends 'base.html' %}

{% load staticfiles let_me_escort leaflet_tags %}

{% block extra_head %}
  {% leaflet_css %}
  <link href="{% static "css/group_buttons.css" %}" rel="stylesheet">
{% endblock %}

{% block breadcrumbs %}
<ol class="breadcrumb">
  <li><a href="#">Home</a></li>
  <li><a href="{% url "let_me_app:view_site" pk=object.site_id %}">Site</a></li>
  <li class="active">Court</li>
</ol>
{% endblock %}

{% block main %}
<div class="row-fluid">
  <div class="col-md-6">
    {% leaflet_map "yourmap" callback="window.map_init_basic" %}
    {% with images=object.galleryimage_set.all %}
      {% include "images/gallery.html" %}
    {% endwith %}
  </div>
  <div class="col-md-6">
    <h2>
      {% followdropdown object "escort/follow_menu.html" %}
        {{ object.site.name }}
      {% endfollowdropdown %}
    </h2>
    <h3> Description </h3>
    <p>
      {{ object.description|linebreaksbr }}
    </p>
    <h3> Events </h3>
    <ul>
      {% for event in object.event_set.all %}
        <li>
          {% followdropdown event "escort/follow_menu.html" %}
            <a href="{% url "let_me_app:view_event" pk=event.id %}"> {{ event.name }} ({{ event.start_at }}) </a>
            {% ifequal event.status 1 %}
              <span class="label label-success">Pending</span>
            {% else %}
              {% ifequal event.status 2 %}
                <span class="label label-primary">Completed</span>
              {% else %}
                <span class="label label-default">Cancelled</span>
              {% endifequal %}
            {% endifequal %}
          {% endfollowdropdown %}
        </li>
      {% endfor %}
    </ul>
    {% if is_admin %}
      <h3> Admin group </h3>
      <ul>
        {% for group_user in object.admin_group.user_set.all %}
        <li>
          {% followdropdown group_user "escort/follow_menu.html" %}
            {{ group_user.email }}
          {% endfollowdropdown %}
           <div class="ui-group-buttons">
             {% with user=group_user %}
               {% include "courts/buttons/remove_from_admin.html" %}
             {% endwith %}
           </div>
        </li>
        {% endfor %}
    {% endif %}

    <div class="ui-group-buttons pull-right marginBottom10">
      {% for action in court_actions %}
        {% include "courts/buttons/"|add:action|add:'.html' %}
        <div class="or"></div>
      {% endfor %}
      <a href="{% url 'let_me_app:create_court_event' court=object.id site=object.site_id %}" class="btn btn-primary">
        <span class="glyphicon glyphicon-record" aria-hidden="true"></span>
        Create event
      </a>
    </div>

  </div>
</div>

{% include "courts/modals/add_to_admin_group.html" %}

{% endblock %}

{% block extra_scripts %}
  {% include "autocomplete_light/static.html" %}
  {% leaflet_js %}
  <script type="text/javascript">
      function map_init_basic (map, options) {
          L.marker([{{ object.site.geo_point.1 }}, {{ object.site.geo_point.0 }}]).addTo(map);
          map.panTo(new L.LatLng({{ object.site.geo_point.1 }}, {{ object.site.geo_point.0 }}));
      }
  </script>
{% endblock %}